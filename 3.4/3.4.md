# Домашнее задание к занятию «Обновление приложений»

### Цель задания

Выбрать и настроить стратегию обновления приложения.

### Чеклист готовности к домашнему заданию

1. Кластер K8s.

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Документация Updating a Deployment](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment).
2. [Статья про стратегии обновлений](https://habr.com/ru/companies/flant/articles/471620/).

-----

### Задание 1. Выбрать стратегию обновления приложения и описать ваш выбор

1. Имеется приложение, состоящее из нескольких реплик, которое требуется обновить.
2. Ресурсы, выделенные для приложения, ограничены, и нет возможности их увеличить.
3. Запас по ресурсам в менее загруженный момент времени составляет 20%.
4. Обновление мажорное, новые версии приложения не умеют работать со старыми.
5. Вам нужно объяснить свой выбор стратегии обновления приложения.

### Ответ 1

При выборе стратегии обновления приложения в Kubernetes, необходимо учитывать несколько факторов, включая доступные ресурсы, необходимость в высоком уровне доступности и характер обновления.

В данном случае, важно отметить, что:

1. Обновление мажорное: Новые версии приложения не совместимы со старыми, что подразумевает отсутствие возможности откатиться на предыдущую версию, если что-то пойдет не так.
2. Ресурсы ограничены: Доступные ресурсы не могут быть увеличены, так что необходимо продумать обновление так, чтобы не исчерпать имеющиеся ресурсы.
3. Доступность приложения: Приложение должно оставаться доступным в процессе обновления.
   
С учетом вышеперечисленного, рекомендуемой стратегией обновления является "Rolling Update".

Обоснование выбора:

1. Постепенное обновление: Rolling update позволяет обновлять приложение поэтапно, заменяя старые поды новыми, что обеспечивает непрерывность работы и минимальные простои. В нашей ситуации это критично, поскольку приложение должно оставаться доступным на протяжении всего обновления.
2. Управление ресурсами: Поскольку у нас есть запас по ресурсам в 20%, rolling update позволит контролировать нагрузку на кластер. При этой стратегии Kubernetes может одновременно обновлять только несколько реплик, что гарантирует отсутствие перегрузок.
3. Логическая последовательность обновлений: Поскольку новые версии не совместимы со старыми, rolling update обеспечивает отлаженный подход к внедрению изменений. Если возникнут ошибки, мы сможем откатить отдельные поды без полной остановки обслуживания.

Таким образом, выбранная стратегия rolling update отвечает всем требованиям задания, предлагая баланс между доступностью приложения и эффективным управлением ресурсами.

### Задание 2. Обновить приложение

1. Создать deployment приложения с контейнерами nginx и multitool. Версию nginx взять 1.19. Количество реплик — 5.
2. Обновить версию nginx в приложении до версии 1.20, сократив время обновления до минимума. Приложение должно быть доступно.
3. Попытаться обновить nginx до версии 1.28, приложение должно оставаться доступным.
4. Откатиться после неудачного обновления.

### Ответ 2

![image](https://github.com/user-attachments/assets/9bc41ff0-a6fa-4eff-928f-2f534286b074)
![image](https://github.com/user-attachments/assets/59496e14-e5f3-4a6a-838c-127579b12921)
